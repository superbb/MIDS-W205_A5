# Exercise 1:

## 1. loading_and_modeling
```
/loading_and_modeling/ER Diagram.png - ER Diagram
/loading_and_modeling/load_data_lake.sh - loads and unzips files
/loading_and_modeling/hive_base_ddl.sql - cleans files and puts them into hdfs
```

## 2. transforming
```
/transforming/
```
t_effective_care.sql, t_readmissions.sql, t_survey_responses.sql - mostly changes of strings to ints and floats and dropping of unecessary fields

## 3. investigations
best_hospitals/best_hospitals.sql

### A Best Hospitals
`best_hospitals/best_hospitals.sql`
For mortality and readmissions I split the measures into one of those categories and then took an average of the scores within each. I then combined them into an aggregate score weight 2x more on the mortality side when both scores are available. From the care table, I also averaged scores into conditions and then combined those into a single score. Finally I combined the average of the overall data from the survey. With these three measures, I combined and reranked them giving me the order of hospitals from best (1) to worst.

```
name, final_rank (avg of: survey_rank, effective_care_rank, readmissions_and_mortality_rank)

KANSAS SURGERY & RECOVERY CENTER        7.0     12      4       5
NEBRASKA SPINE HOSPITAL, LLC    56.666666666666664      41      85      44
ORTHOCOLORADO HOSPITAL AT ST ANTHONY MED CAMPUS 89.0    1       245     21
SCRIPPS GREEN HOSPITAL  104.33333333333333      229     12      72
THE ORTHOPEDIC SPECIALTY HOSPITAL       127.66666666666667      346     20      17
ADVENTIST LA GRANGE MEMORIAL HOSPITAL   144.66666666666666      138     230     66
HOLLAND COMMUNITY HOSPITAL      174.33333333333334      180     46      297
MIAMI COUNTY MEDICAL CENTER     176.33333333333334      59      137     333
KAISER FOUNDATION HOSPITAL - ROSEVILLE  179.66666666666666      180     47      312
KANSAS MEDICAL CENTER LLC       184.0   138     32      382
```

### B Best States
`best_states/best_states.sql`
To compare states, I aggregated the hospital ratings by state and then sorted them by aggregate rank (less is better). CO, WI, NH, and ME are the top rates, while DC, WV, WY, and AR are the worst.

```
State, Rank, Survey, Effective Care, Readmissions & Mortality
CO      1       1004.9242424242424      924.2272727272727       921.0   1169.5454545454545
WI      2       1013.8410256410255      904.8461538461538       745.0153846153846       1391.6615384615384
NH      3       1067.6153846153845      1142.076923076923       1137.3846153846155      923.3846153846154
ME      4       1069.203703703704       1163.7222222222222      817.2777777777778       1226.611111111111
NE      5       1092.9855072463768      999.2173913043479       889.4782608695652       1390.2608695652175
SD      6       1093.8235294117646      1118.8235294117646      929.2941176470588       1233.3529411764705
IN      7       1181.4959349593498      951.390243902439        1247.341463414634       1345.7560975609756
MT      8       1188.8333333333333      1055.9166666666667      1298.8333333333333      1211.75
UT      9       1228.1034482758619      1228.2758620689656      879.1379310344828       1576.896551724138
MA      10      1234.6969696969702      1385.8727272727272      1472.9454545454546      845.2727272727273
KS      11      1247.807407407407       974.3111111111111       1290.1333333333334      1478.9777777777779
HI      12      1304.3939393939393      900.0   1660.909090909091       1352.2727272727273
ND      13      1338.8333333333333      1232.6666666666667      1263.1666666666667      1520.6666666666667
OH      14      1347.5158730158728      1281.2619047619048      1390.2936507936508      1370.9920634920634
DE      15      1351.2222222222224      1717.8333333333333      1761.3333333333333      574.5
MN      16      1361.9166666666672      1106.4166666666667      1584.4583333333333      1394.875
IA      17      1363.8333333333335      1124.1470588235295      1294.735294117647       1672.6176470588234
MI      18      1375.5568181818182      1398.625        1450.3636363636363      1277.6818181818182
SC      19      1376.8993710691818      1229.6603773584907      1312.377358490566       1588.6603773584907
ID      20      1381.2564102564102      1656.5384615384614      1203.7692307692307      1283.4615384615386
PA      21      1388.7694063926933      1443.8219178082193      1451.1780821917807      1271.3082191780823
IL      22      1388.885333333334       1307.032        1420.144        1439.48
TX      23      1400.7072570725702      1303.5424354243542      1599.5239852398524      1299.0553505535056
NC      24      1406.6980392156865      1342.4470588235295      1254.7176470588236      1622.929411764706
MO      25      1431.6711711711707      1092.7702702702702      1441.445945945946       1760.7972972972973
AZ      26      1439.5402298850577      1307.2586206896551      1725.603448275862       1285.7586206896551
VT      27      1477.1666666666667      1257.5  1811.5  1362.5
CA      28      1480.8303886925796      1475.7703180212013      1575.904593639576       1390.816254416961
CT      29      1483.9523809523812      1749.4285714285713      1449.4285714285713      1253.0
VA      30      1485.7361111111109      1496.361111111111       1147.7222222222222      1813.125
FL      31      1501.2407407407409      1543.067901234568       1438.6049382716049      1522.0493827160494
WA      32      1565.6597222222217      1406.6666666666667      1539.8333333333333      1750.4791666666667
OR      33      1566.4607843137255      1141.0  1819.9411764705883      1738.4411764705883
NJ      34      1568.6031746031745      1676.4444444444443      1656.6666666666667      1372.6984126984128
RI      35      1641.848484848485       1455.4545454545455      2124.181818181818       1345.909090909091
GA      36      1643.6734693877563      1334.1020408163265      1786.5204081632653      1810.3979591836735
OK      37      1646.4507042253522      1539.6901408450703      1738.338028169014       1661.3239436619717
NV      38      1649.1746031746031      1509.952380952381       1447.4761904761904      1990.095238095238
TN      39      1687.461240310077       1504.8720930232557      1606.1744186046512      1951.3372093023256
KY      40      1725.6984126984132      1440.5238095238096      1768.4285714285713      1968.142857142857
AL      41      1736.9385964912278      1275.0  2007.092105263158       1928.7236842105262
LA      42      1738.8902439024394      1346.621951219512       2168.268292682927       1701.780487804878
AK      43      1772.25 1649.25 1727.25 1940.25
NM      44      1790.7866666666666      1717.6  1816.72 1838.04
NY      45      1804.5653153153166      1768.6418918918919      1839.472972972973       1805.581081081081
MS      46      1809.8750000000002      1206.4583333333333      2122.5  2100.6666666666665
DC      47      1855.5238095238096      2012.857142857143       2045.0  1508.7142857142858
WV      48      1902.0714285714282      1640.25 2047.4285714285713      2018.5357142857142
WY      49      1913.7000000000003      1747.4  1859.1  2134.6
AR      50      1943.6136363636358      1444.3863636363637      1908.840909090909       2477.6136363636365
```


### C Hospital Variability
`hospital_variability/hospital_variability.sql`
To compare the variability of hospitals, I chose to look at the differences between rankings within each state. I found the first and third quartile rankings and looked at the range between them and then sorted the states from greatest to least (most volatile to least). 

I expected larger states to rank highest, however, DC and HI ranked higher than TX. Also, volatility and quality didn't correlate. SD is ranked 6 as a state but has a very wide range, while WY is ranked 49th and has a very small range.

```
state	range	min_score	max_score	overall_state_rank
ND      1416.0  784.3333333333334       2200.3333333333335      13
SD      1100.3333333333335      558.6666666666666       1659.0  6
KY      1000.3333333333333      1236.6666666666667      2237.0  40
DC      927.0   1464.0  2391.0  47
HI      920.0   910.0   1830.0  12
DE      917.3333333333334       968.6666666666666       1886.0  15
TN      906.6666666666665       1198.0  2104.6666666666665      39
UT      904.3333333333334       846.3333333333334       1750.6666666666667      9
TX      884.3333333333334       934.6666666666666       1819.0  23
LA      878.3333333333335       1324.0  2202.3333333333335      42
PA      864.6666666666666       974.6666666666666       1839.3333333333333      21
AZ      859.0000000000001       1020.6666666666666      1879.6666666666667      26
MS      846.3333333333335       1401.0  2247.3333333333335      46
NC      831.3333333333333       1040.0  1871.3333333333333      24
CA      831.0   1068.3333333333333      1899.3333333333333      28
OK      829.6666666666667       1221.6666666666667      2051.3333333333335      37
MI      829.6666666666667       977.0   1806.6666666666667      18
OR      818.0   1170.3333333333333      1988.3333333333333      33
IL      792.3333333333334       989.6666666666666       1782.0  22
OH      790.6666666666666       975.6666666666666       1766.3333333333333      14
MO      766.3333333333333       1049.6666666666667      1816.0  25
MT      756.9999999999999       735.3333333333334       1492.3333333333333      8
IA      749.3333333333334       1003.3333333333334      1752.6666666666667      17
VA      738.3333333333335       1116.3333333333333      1854.6666666666667      30
WA      737.3333333333333       1233.0  1970.3333333333333      32
FL      727.3333333333333       1162.6666666666667      1890.0  31
NY      705.3333333333333       1505.3333333333333      2210.6666666666665      45
VT      704.6666666666665       1253.6666666666667      1958.3333333333333      27
NH      696.6666666666667       744.0   1440.6666666666667      3
WV      691.3333333333333       1521.6666666666667      2213.0  48
NJ      691.0   1276.6666666666667      1967.6666666666667      34
NE      678.3333333333334       757.6666666666666       1436.0  5
AR      672.6666666666667       1634.3333333333333      2307.0  50
WI      671.0   649.0   1320.0  2
CT      662.3333333333335       1129.3333333333333      1791.6666666666667      29
IN      648.3333333333334       861.3333333333334       1509.6666666666667      7
ME      646.6666666666666       747.3333333333334       1394.0  4
KS      642.3333333333334       973.3333333333334       1615.6666666666667      11
GA      639.0   1371.0  2010.0  36
SC      636.0   1076.6666666666667      1712.6666666666667      19
MA      627.9999999999999       952.3333333333334       1580.3333333333333      10
AK      627.6666666666667       1510.3333333333333      2138.0  43
RI      625.6666666666667       1371.3333333333333      1997.0  35
NM      571.0   1656.0  2227.0  44
MN      565.6666666666667       1115.3333333333333      1681.0  16
AL      548.0   1498.3333333333333      2046.3333333333333      41
ID      541.0   1179.6666666666667      1720.6666666666667      20
CO      519.3333333333334       759.6666666666666       1279.0  1
NV      480.0   1488.6666666666667      1968.6666666666667      38
WY      458.0   1725.0  2183.0  49
```
### D Hospitals & Patients:
`/investigations/hospitals_and_patients.sql`

```
Survey Quartile, Survey Avg, Mortality Avg Rank
1       96.9693290973953        1665.8006453694738
2       94.64619997070606       1644.0576550387595
3       92.40944665019562       1674.4456233850144
4       81.07748490577389       1902.3160045219631
```

While a small drop in the survey correlates with a small drop in the average rankings for mortality-related measures and a big drop has a much bigger drop for mortality measures as well. This supports the idea that hospitals that treat patients better and have better communication are less likely to have fatalities. 

It could be however, that the relationship goes the other way too--people at hospitals which see more fatalities may not be able to give as much time and care to patients because they are busier with emergencies.
